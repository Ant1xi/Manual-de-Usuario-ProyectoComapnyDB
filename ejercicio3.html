<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Ejercicio 3 - Modificar Cliente</title>
    <link rel="stylesheet" href="estilo_pagina_principal.css" />
  </head>
  <body>
    <a href="Pagina_principal.html" style="display: block; margin-bottom: 20px">
      ‚¨Ö Volver al √≠ndice
    </a>

    <a href="ejercicio4.html" class="boton-navegacion">
      Ver siguiente ejercicio ‚û°Ô∏è
    </a>

    <h1>Ejercicio 3 - Modificar Cliente</h1>

    <h2>üìå Objetivo</h2>
    <p>
      Mostrar en una tabla todos los clientes registrados y permitir modificar
      sus datos (tanto los del cliente como del contacto relacionado).
    </p>

    <img
      src="imagenes/ejercicio3_img1.png"
      alt="Tabla con los clientes"
      style="max-width: 100%; margin-bottom: 20px"
    />

    <h2>üß† ¬øQu√© hace este ejercicio?</h2>
    <p>
      Se abre una ventana con un <code>JTable</code> que muestra los datos de
      todos los clientes. Si el usuario selecciona uno, se activa el bot√≥n
      ‚ÄúModificar cliente‚Äù. Al pulsarlo, se abre otra ventana donde aparecen los
      campos editables con los datos actuales del cliente y su contacto. Cuando
      se pulsan los cambios, se actualizan en la base de datos usando dos
      <code>UPDATE</code>: uno para la tabla <code>customers</code> y otro para
      <code>contacts</code>.
    </p>

    <h2>üß≠ ¬øD√≥nde empieza todo?</h2>
    <h3>1Ô∏è‚É£ Desde la ventana principal</h3>
    <p>
      Cuando se pulsa el bot√≥n ‚ÄúModificar cliente‚Äù, se llama al m√©todo
      <code>cargarVistaModificarCustomers()</code> del controlador
      <code>ModificarCustomerControllerEjercicio3</code>. Este m√©todo se conecta
      a la base de datos y obtiene la lista de todos los clientes usando
      <code>CustomerDAOImpl.getAll()</code>. Esa lista se pasa a la vista
      <code>TablaClienteVista</code> para rellenar el <code>JTable</code>.
    </p>

    <img
      src="imagenes/ejercicio3_img2.png"
      alt="Controlador cargando clientes"
      style="max-width: 100%; margin-bottom: 20px"
    />

    <img
      src="imagenes/ejercicio3_img3.png"
      alt="Controlador cargando clientes"
      style="max-width: 100%; margin-bottom: 20px"
    />

    <h2>üñ±Ô∏è ¬øQu√© pasa al pulsar ‚ÄúModificar cliente‚Äù?</h2>
    <ul>
      <li>Se comprueba si hay una fila seleccionada en la tabla.</li>
      <li>Se obtiene el <code>customer_id</code> de ese cliente.</li>
      <li>
        Con ese ID se busca tambi√©n el contacto con
        <code>ContactDAOImpl.getByCustomerId()</code>.
      </li>
      <li>
        Se mete todo en un DTO que hice precisamente para este ejercicio:
        <code>ClienteModificarDTO</code>.
      </li>
      <li>
        Y se abre la ventana <code>FormularioModificarClienteVista</code> con
        esos datos cargados.
      </li>
    </ul>

    <img
      src="imagenes/ejercicio3_img4.png"
      alt="Formulario edici√≥n cliente"
      style="max-width: 100%; margin-bottom: 20px"
    />

    <h2>üñ•Ô∏è ¬øQu√© hace la vista?</h2>
    <p>
      La clase <code>FormularioModificarClienteVista</code> muestra un
      formulario con los siguientes campos:
    </p>

    <ul>
      <li>
        <strong>Datos del cliente:</strong> nombre, direcci√≥n, web, l√≠mite de
        cr√©dito
      </li>
      <li>
        <strong>Datos del contacto:</strong> nombre, apellidos, email, tel√©fono
      </li>
    </ul>

    <p>
      Cuando se pulsa el bot√≥n ‚ÄúGrabar cambios‚Äù, se llaman a los m√©todos
      <code>update()</code> de los dos DAOs y se guardan los cambios en la base
      de datos.
    </p>

    <img
      src="imagenes/ejercicio3_img5.png"
      alt="Formulario con datos cargados"
      style="max-width: 100%; margin-bottom: 20px"
    />

    <h2>üß© ¬øQu√© hace el controlador?</h2>
    <p>
      El controlador es el que se encarga de conectar todo: primero carga los
      clientes, luego cuando pulsas el bot√≥n de modificar, se encarga de buscar
      los datos del contacto, montar el DTO con toda la informaci√≥n, y abrir la
      nueva vista.
    </p>

    <p>
      Como Java me daba error al intentar usar una lista dentro de un
      <code>ActionListener</code>, us√© un peque√±o truco que encontr√©: met√≠ la
      lista en un array de un solo elemento, y as√≠ me dejaba acceder sin
      problema.
    </p>

    <pre><code>// Truco para poder usar la lista dentro del bot√≥n
final List&lt;Customer&gt;[] listaClientes = new List[1];
listaClientes[0] = customerDAO.getAll(conn);
...
Customer cliente = listaClientes[0].get(filaSeleccionada);</code></pre>

    <h2>‚úÖ Validaciones</h2>
    <ul>
      <li>
        El bot√≥n de ‚ÄúModificar cliente‚Äù no se activa si no se ha seleccionado
        nada.
      </li>
      <li>Se muestran mensajes de error si algo falla al cargar o guardar.</li>
    </ul>

    <img
      src="imagenes/ejercicio3_img6.png"
      alt="Formulario edici√≥n cliente"
      style="max-width: 100%; margin-bottom: 20px"
    />

    <h2>‚ö†Ô∏è Problemas encontrados</h2>
    <ul>
      <li>
        Al principio no sab√≠a c√≥mo juntar los datos del cliente y el contacto,
        pero haciendo un DTO propio me qued√≥ todo m√°s organizado y fue m√°s f√°cil
        pasarlo a la vista.
      </li>
    </ul>
    <img
      src="imagenes/ejercicio3_img7.png"
      alt="DTO del ejercicio 3 llenandose en el controller"
      style="max-width: 100%; margin-bottom: 20px"
    />
    <img
      src="imagenes/ejercicio3_img8.png"
      alt="Vista recoge DTO del ejercicio 3"
      style="max-width: 100%; margin-bottom: 1px"
    />

    <h2>üîö Conclusi√≥n</h2>
    <p>
      Este ejercicio me ayud√≥ bastante a entender c√≥mo trabajar con datos que
      vienen de dos tablas distintas. Tambi√©n vi lo importante que es separar
      bien los DAOs, la vista y el controlador para no liarse. Al principio me
      cost√≥ entender c√≥mo encajarlo todo, pero ahora que lo tengo montado, lo
      veo claro y funciona bien.
    </p>
  </body>
</html>
